@model List<Opportunity>
@{
    ViewData["Title"] = "Archived Opportunity List";
}
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>@ViewData["Title"]</title>
    <link href="~/lib/datatables/css/dataTables.bootstrap4.min.css" rel="stylesheet" />
</head>
<body>
    @Html.AntiForgeryToken()
    <table id="oppTable" class="table table-bordered table-striped" style="width: 100%" cellpadding="0" cellspacing="0">
        <thead class="thead-light">
            <tr>
                <th><b>@Html.DisplayNameFor(x => x.FirstOrDefault()!.Name)</b></th>
                <th><b>@Html.DisplayNameFor(x => x.FirstOrDefault()!.StartTime)</b></th>
                <th><b>@Html.DisplayNameFor(x => x.FirstOrDefault()!.EndTime)</b></th>
                <th><b>@Html.DisplayNameFor(x => x.FirstOrDefault()!.Address)</b></th>
                <th><b>@Html.DisplayNameFor(x => x.FirstOrDefault()!.City)</b></th>
                <th><b>@Html.DisplayNameFor(x => x.FirstOrDefault()!.State)</b></th>
                <th><b>@Html.DisplayNameFor(x => x.FirstOrDefault()!.Zip)</b></th>
                <th><b>@Html.DisplayNameFor(x => x.FirstOrDefault()!.SlotsAvailable)</b></th>
                <th> </th>
            </tr>
        </thead>
        <tbody>
            @using (Html.BeginForm("Unarchive", "Opportunity"))
            {
                if (Model == null || !Model.Any(x => x.isArchived))
                {
                    <tr><td colspan="9">No archived opportunities</td></tr>
                    return;
                }

                foreach (var opp in Model.Where(x => x.isArchived))
                {
                    <tr>
                        <td>@opp.Name</td>
                        <td>@opp.StartTime.ToString("MM/dd/yyyy hh:mm tt")</td>
                        <td>@opp.EndTime.ToString("MM/dd/yyyy hh:mm tt")</td>
                        <td>@opp.Address</td>
                        <td>@opp.City</td>
                        <td>@opp.State</td>
                        <td>@opp.Zip</td>
                        <td>@opp.SlotsAvailable</td>
                        <td>
                            @Html.ActionLink("Edit", "Edit", new { Id = opp.Id }) |
                            @Html.ActionLink("View", "Details", new { Id = opp.Id }) |
                            @Html.ActionLink("Delete", "Delete", new { Id = opp.Id }, new { onclick = "return confirmDelete()" }) |
                            @Html.ActionLink("Unarchive", "ArchiveList", new { Id = opp.Id }, new { onclick = "return confirmUnarchive()" })
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
</body>
</html>
@section Scripts
{
    <script src="~/lib/datatables/js/jquery.dataTables.min.js"></script>
    <script src="~/lib/datatables/js/dataTables.bootstrap4.min.js"></script>
    <script src="~/js/customerDatatable.js"></script>
    <script>import DataTable from 'datatables.net';
        import 'datatables.net-responsive-dt';

        $(document).ready(function () {
            $('#oppTable').DataTable({
                responsive: true,
                processing: true,
                ordering: true,
                paging: true,
                searching: true,
                ajax: "api/Opportunities",
                columns: [
                    { "data": "Name" },
                    { "data": "StartTime" },
                    { "data": "EndTime" },
                    { "data": "Address" },
                    { "data": "City" },
                    { "data": "State" },
                    { "data": "Zip" },
                    { "data": "SlotsAvailable" }
                ]
            });
        });
        function confirmDelete() {
            return confirm("Are you sure you want to delete this Opportunity? This action is permenant, once you click ok you wont be able to get it back.");
        }

        function confirmUnarchive() {
            return confirm("Are you sure you want to unarchive this Opportunity? This item will be moved to the Opportunity list. ");
        }
    </script>
}